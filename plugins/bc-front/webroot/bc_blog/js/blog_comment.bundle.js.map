{"version":3,"file":"bc_blog/js/blog_comment.bundle.js","mappings":";;;;;;;;;;AAaA,IAAMA,EAAS,CAKXC,gBAAgB,EAKhBC,aAAa,EAKbC,UAAW,KAKXC,QAAO,WACH,IAAMC,EAAUC,EAAE,wBAClBN,EAAOC,eAAiBI,EAAQE,KAAK,uBACrCP,EAAOE,YAAcG,EAAQE,KAAK,oBAClCP,EAAOG,UAAYE,EAAQE,KAAK,kBAChCP,EAAOQ,WACPR,EAAOS,gBACX,EAKAA,eAAc,WACVH,EAAE,yBAAyBI,GAAG,SAAS,WAInC,OAHGV,EAAOW,YACNX,EAAOY,eAEJ,CACX,GACJ,EAKAJ,SAAQ,WACDR,EAAOE,aAAaF,EAAOa,kBAC9BP,EAAE,SAASQ,IAAI,IACfR,EAAE,UAAUQ,IAAI,IAChBR,EAAE,QAAQQ,IAAI,IACdR,EAAE,YAAYQ,IAAI,GACtB,EAKAF,YAAW,WACPN,EAAE,yBAAyBS,KAAK,YAAY,GAC5CT,EAAEU,QAAQC,OAAM,WACZ,IAAIC,EAAOZ,EAAE,uBAGb,OAFAY,EAAKC,KAAK,4BAA4BC,SACtCF,EAAKG,OAAOf,EAAEU,QAAQM,kBACfhB,EAAEiB,KAAK,CACVC,IAAKlB,EAAEmB,OAAOC,QAAU,iCACxBC,KAAM,OACNC,KAAMV,EAAKW,YACXC,SAAU,OACVC,WAAY,WACRzB,EAAE,kBAAkB0B,SACxB,EACAC,QAAS,SAAUC,GACf,GAAIA,EAAQ,CACRlC,EAAOQ,WACPF,EAAE,2BAA2BQ,IAAI,IACjC,IAAIqB,EAAgB,GACpB,GAAInC,EAAOC,eACPkC,EAAgBC,OAAOC,yBACvB/B,EAAE,kBAAkBgC,KAAKH,GAAeI,WACrC,CACH,IAAIC,EAAUlC,EAAE4B,GAChBM,EAAQC,OACRnC,EAAE,oBAAoBe,OAAOmB,GAC7BA,EAAQE,UAAU,KAClBC,SAASC,KAAOJ,EAAQjC,KAAK,KACjC,CACJ,MACIP,EAAO6C,WAEf,EACAC,MAAO,SAAUZ,GACblC,EAAO6C,UAAUX,EACrB,EACAa,SAAU,WACNzC,EAAEU,QAAQgC,IAAM,KAChB1C,EAAE,yBAAyB2C,WAAW,WAC1C,GAER,GAAG,CAACC,WAAW,GACnB,EAKAvC,SAAQ,WACJ,IAAIwC,EAAM,GAYV,OAXK7C,EAAE,SAASQ,QACZqC,GAAOf,OAAOgB,iBAAmB,MAEhC9C,EAAE,YAAYQ,QACfqC,GAAOf,OAAOiB,oBAAsB,MAEpCrD,EAAOE,cACFI,EAAE,iBAAiBQ,QACpBqC,GAAOf,OAAOkB,sBAAwB,QAG1CH,IACAI,MAAMJ,IACC,EAGf,EAKAN,UAAS,SAACX,GACHlC,EAAOE,cACNF,EAAOa,kBACPP,EAAE,2BAA2BQ,IAAI,KAErC0C,QAAQC,IAAIC,KAAKC,MAAMzB,EAAO0B,eAC9BtD,EAAE,kBAAkBgC,KAAKF,OAAOyB,mBAAmBnB,WACvD,EAKA7B,gBAAe,WACX,GAAIb,EAAOE,YAAa,CACpB,IAAIC,EAAY2D,KAAKC,MAAsB,IAAhBD,KAAKE,UAC5BC,EAAM3D,EAAE,0BAA0BgC,OAAS,IAAMnC,EACrDG,EAAE,qBAAqBmC,OACvBnC,EAAE,kBAAkBiC,OACpBjC,EAAE,qBAAqBI,GAAG,QAAQ,WAC9BJ,EAAE,kBAAkBmC,OACpBnC,EAAE,qBAAqB4D,OAAO,IAClC,IACA5D,EAAE,qBAAqBC,KAAK,MAAO0D,EACvC,CACJ,GAIJjE,EAAOI,S","sources":["webpack://bc-front/./src/bc_blog/js/blog_comment.js"],"sourcesContent":["/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) NPO baser foundation <https://baserfoundation.org/>\n *\n * @copyright     Copyright (c) NPO baser foundation\n * @link          https://basercms.net baserCMS Project\n * @since         5.0.0\n * @license       https://basercms.net/license/index.html MIT License\n */\n\n/**\n * ブログコメント送信\n */\nconst bcBlog = {\n\n    /**\n     * コメントの承認あり・なし\n     */\n    commentApprove: false,\n\n    /**\n     * キャプチャ認証を利用するかどうか\n     */\n    authCaptcha: false,\n\n    /**\n     * キャプチャID\n     */\n    captchaId: null,\n\n    /**\n     * 初期化\n     */\n    mounted() {\n        const $script = $(\"#BlogCommentsScripts\");\n        bcBlog.commentApprove = $script.attr('data-commentApprove');\n        bcBlog.authCaptcha = $script.attr('data-authCaptcha');\n        bcBlog.captchaId = $script.attr('data-captchaId');\n        bcBlog.initView();\n        bcBlog.registerEvents();\n    },\n\n    /**\n     * イベント登録\n     */\n    registerEvents() {\n        $(\"#BlogCommentAddButton\").on('click', function () {\n            if(bcBlog.validate()) {\n                bcBlog.sendComment();\n            }\n            return false;\n        });\n    },\n\n    /**\n     * 表示を初期化する\n     */\n    initView() {\n        if(bcBlog.authCaptcha) bcBlog.loadAuthCaptcha();\n        $(\"#name\").val('');\n        $(\"#email\").val('');\n        $(\"#url\").val('');\n        $(\"#message\").val('');\n    },\n\n    /**\n     * コメントを送信する\n     */\n    sendComment() {\n        $(\"#BlogCommentAddButton\").prop('disabled', true);\n        $.bcToken.check(function () {\n            let form = $(\"#BlogCommentAddForm\");\n            form.find('input[name=\"_csrfToken\"]').remove();\n            form.append($.bcToken.getHiddenToken());\n            return $.ajax({\n                url: $.bcUtil.baseUrl + '/bc-blog/blog/ajax_add_comment',\n                type: 'POST',\n                data: form.serialize(),\n                dataType: 'html',\n                beforeSend: function () {\n                    $(\"#ResultMessage\").slideUp();\n                },\n                success: function (result) {\n                    if (result) {\n                        bcBlog.initView()\n                        $(\"#BlogCommentAuthCaptcha\").val('');\n                        let resultMessage = '';\n                        if (bcBlog.commentApprove) {\n                            resultMessage = bcI18n.alertMessageAuthComplete;\n                            $(\"#ResultMessage\").html(resultMessage).show();\n                        } else {\n                            let comment = $(result);\n                            comment.hide();\n                            $(\"#BlogCommentList\").append(comment);\n                            comment.slideDown(500);\n                            location.hash = comment.attr('id');\n                        }\n                    } else {\n                        bcBlog.postError();\n                    }\n                },\n                error: function (result) {\n                    bcBlog.postError(result);\n                },\n                complete: function () {\n                    $.bcToken.key = null;\n                    $(\"#BlogCommentAddButton\").removeAttr('disabled');\n                }\n            });\n        }, {useUpdate: false});\n    },\n\n    /**\n     * バリデーション\n     */\n    validate() {\n        let msg = '';\n        if (!$(\"#name\").val()) {\n            msg += bcI18n.alertMessageName + '\\n';\n        }\n        if (!$(\"#message\").val()) {\n            msg += bcI18n.alertMessageComment + '\\n';\n        }\n        if (bcBlog.authCaptcha) {\n            if (!$(\"#auth_captcha\").val()) {\n                msg += bcI18n.alertMessageAuthImage + '\\n';\n            }\n        }\n        if (msg) {\n            alert(msg);\n            return false;\n        }\n        return true;\n    },\n\n    /**\n     * エラー処理\n     */\n    postError(result) {\n        if(bcBlog.authCaptcha) {\n            bcBlog.loadAuthCaptcha();\n            $(\"#BlogCommentAuthCaptcha\").val('');\n        }\n        console.log(JSON.parse(result.responseText));\n        $(\"#ResultMessage\").html(bcI18n.alertMessageError).slideDown();\n    },\n\n    /**\n     * キャプチャ画像を読み込む\n     */\n    loadAuthCaptcha() {\n        if (bcBlog.authCaptcha) {\n            let captchaId = Math.floor(Math.random() * 100);\n            let src = $(\"#BlogCommentCaptchaUrl\").html() + '?' + captchaId;\n            $(\"#AuthCaptchaImage\").hide();\n            $(\"#CaptchaLoader\").show();\n            $(\"#AuthCaptchaImage\").on('load', function () {\n                $(\"#CaptchaLoader\").hide();\n                $(\"#AuthCaptchaImage\").fadeIn(1000);\n            });\n            $(\"#AuthCaptchaImage\").attr('src', src);\n        }\n    }\n\n}\n\nbcBlog.mounted();\n\n\n\n\n\n"],"names":["bcBlog","commentApprove","authCaptcha","captchaId","mounted","$script","$","attr","initView","registerEvents","on","validate","sendComment","loadAuthCaptcha","val","prop","bcToken","check","form","find","remove","append","getHiddenToken","ajax","url","bcUtil","baseUrl","type","data","serialize","dataType","beforeSend","slideUp","success","result","resultMessage","bcI18n","alertMessageAuthComplete","html","show","comment","hide","slideDown","location","hash","postError","error","complete","key","removeAttr","useUpdate","msg","alertMessageName","alertMessageComment","alertMessageAuthImage","alert","console","log","JSON","parse","responseText","alertMessageError","Math","floor","random","src","fadeIn"],"sourceRoot":""}